# 006: レポート・帳票出力機能

## 概要
各種レポート生成、帳票出力、データエクスポート機能を実装する

## 優先度
**High** - 給与計算・労基署提出に必須

## 見積工数
40時間（5人日）

## 機能要件

### 1. 労基署提出帳票
- [ ] 時間外労働・休日労働に関する協定届（36協定）
- [ ] 賃金台帳
- [ ] 労働者名簿
- [ ] 年次有給休暇管理簿
- [ ] 労働時間等設定改善委員会議事録

### 2. 給与計算用データ
- [ ] 月次勤怠データCSV出力
  - [ ] 社員番号
  - [ ] 氏名
  - [ ] 所定労働時間
  - [ ] 実労働時間
  - [ ] 普通残業時間
  - [ ] 深夜残業時間
  - [ ] 休日労働時間
  - [ ] 遅刻/早退回数
  - [ ] 欠勤日数
- [ ] カスタムフォーマット対応
- [ ] 文字コード選択（UTF-8/Shift-JIS）

### 3. 管理用レポート
- [ ] 月次勤怠集計表
- [ ] 部署別労働時間レポート
- [ ] 残業時間ランキング
- [ ] 有給取得状況レポート
- [ ] 36協定遵守状況レポート
- [ ] 健康管理レポート

### 4. 個人用帳票
- [ ] 勤怠明細書
- [ ] 年間勤怠サマリー
- [ ] 有給残高通知書
- [ ] 残業申請書（印刷用）

### 5. 分析レポート
- [ ] 労働生産性分析
- [ ] 残業要因分析
- [ ] 出勤率推移
- [ ] 部署間比較分析
- [ ] コスト分析

### 6. エクスポート機能
- [ ] CSV出力
- [ ] Excel出力（xlsx形式）
- [ ] PDF出力
- [ ] 一括ダウンロード
- [ ] メール送信機能
- [ ] 定期自動出力設定

## 技術仕様

### データベーステーブル
- report_templates
- report_schedules
- export_history
- report_settings

### API エンドポイント
```
GET    /api/reports/templates
POST   /api/reports/generate
GET    /api/reports/download/:id
POST   /api/exports/csv
POST   /api/exports/excel
POST   /api/exports/pdf
GET    /api/exports/history
POST   /api/reports/schedule
```

### フロントエンド画面
- /reports - レポート一覧
- /reports/generate - レポート生成
- /reports/templates - テンプレート管理
- /exports - エクスポート履歴
- /admin/reports/schedule - 定期出力設定

### 使用ライブラリ
- ExcelJS（Excel生成）
- PDFKit / Puppeteer（PDF生成）
- node-cron（定期実行）
- nodemailer（メール送信）

## 依存関係
- 003: 勤怠管理機能
- 005: 管理画面・ダッシュボード

## テスト項目
- [ ] CSV出力の正確性
- [ ] Excel形式の互換性
- [ ] PDF レイアウト
- [ ] 大量データ処理
- [ ] 文字化け対策
- [ ] 定期実行

## 完了条件
- [ ] 必要な帳票が出力できる
- [ ] データが正確に出力される
- [ ] 各種フォーマットに対応
- [ ] 大量データでも安定動作
- [ ] 出力時間5秒以内（1000件）

## 備考
- 法定帳票は様式を正確に再現
- 給与システムとの連携を考慮
- 監査対応のため出力履歴を保持