# 004: シフト・レイバー統合管理機能

## 概要
製造業特有のシフト制勤務に対応したシフト管理機能と、30分刻みの詳細な作業配置（レイバー）管理機能を統合実装する

## 優先度
**Medium** - Phase 2での実装

## 見積工数
64時間（8人日）※レイバー管理機能追加により拡張

## 機能要件

### 1. シフトパターン管理
- [ ] シフトパターンの登録
  - [ ] 日勤（例：8:00-17:00）
  - [ ] 夜勤（例：20:00-5:00）
  - [ ] 早番（例：6:00-14:00）
  - [ ] 遅番（例：14:00-22:00）
  - [ ] **変則時間（カスタム時間設定）**
- [ ] 休憩時間の設定
- [ ] 深夜帯の自動判定
- [ ] シフト間の最低休息時間設定

### 2. シフト割当
- [ ] 個人別シフト割当
- [ ] 部署別一括割当
- [ ] ローテーションパターン設定
- [ ] シフト交代申請
- [ ] シフト確定/公開機能
- [ ] **2週間シフト自動生成**

### 3. シフト表示
- [ ] 月間シフトカレンダー
- [ ] 週間シフト表
- [ ] 部署別シフト一覧
- [ ] 個人シフト表
- [ ] シフト印刷機能
- [ ] **リアルタイム編集機能**

### 4. 人員配置管理
- [ ] 必要人員数の設定
- [ ] スキル要件の設定
- [ ] 人員過不足の可視化
- [ ] 欠員アラート
- [ ] 代替要員の提案

### 5. シフト制約管理
- [ ] 連続勤務日数制限
- [ ] 月間夜勤回数制限
- [ ] 公休日数の確保
- [ ] 有資格者の配置確認
- [ ] 労働時間上限チェック

### 6. **レイバー管理機能（新規）**
- [ ] **30分刻みの詳細作業配置**
  - [ ] 6:00-24:00の時間軸管理
  - [ ] 作業タスクのドラッグ&ドロップ配置
  - [ ] シフト時間内での作業制限
- [ ] **スキルベース作業割当**
  - [ ] 従業員スキルと作業要件のマッチング
  - [ ] スキル不足の可視化
  - [ ] 効率性自動計算（レベル × スキルマッチ）
- [ ] **作業タスク管理**
  - [ ] 開店/開始準備
  - [ ] 製造作業（プレス、溶接、組立など）
  - [ ] 品質検査
  - [ ] 設備保全
  - [ ] 清掃・整理整頓
  - [ ] 休憩時間
  - [ ] 閉店/終了準備
- [ ] **レイバー最適化**
  - [ ] AI的な作業配置自動生成
  - [ ] 効率性に基づく色分け表示
  - [ ] 作業負荷バランス調整
  - [ ] ボトルネック検出

### 7. **製造業特化機能（新規）**
- [ ] **部門別管理**
  - [ ] 第一工場、第二工場、第三工場
  - [ ] プレス部門、溶接部門
  - [ ] 間接部門
- [ ] **製造ライン連携**
  - [ ] ライン別必要人員設定
  - [ ] 工程間の人員移動管理
  - [ ] 多能工の柔軟配置
- [ ] **安全管理連携**
  - [ ] 危険作業の有資格者チェック
  - [ ] 連続作業時間制限
  - [ ] 疲労度考慮配置

### 8. **統合ダッシュボード（新規）**
- [ ] **リアルタイム監視**
  - [ ] 現在の人員配置状況
  - [ ] 作業効率リアルタイム表示
  - [ ] アラート・警告表示
- [ ] **統計・分析**
  - [ ] 日別/週別効率性レポート
  - [ ] スキル向上進捗追跡
  - [ ] 最適化提案機能

## 技術仕様

### データベーステーブル
- shift_patterns
- user_shifts
- shift_requirements
- shift_constraints
- shift_requests
- **labor_assignments（新規）**
- **labor_tasks（新規）**
- **labor_efficiency_logs（新規）**

### API エンドポイント
```
# 既存のシフト管理API
GET    /api/shifts/patterns
POST   /api/shifts/patterns
GET    /api/shifts/calendar/:yearMonth
POST   /api/shifts/assign
POST   /api/shifts/assign/bulk
GET    /api/shifts/user/:userId
POST   /api/shifts/swap
GET    /api/shifts/requirements
POST   /api/shifts/validate

# 新規のレイバー管理API
GET    /api/labor/assignments/:date
POST   /api/labor/assignments
PUT    /api/labor/assignments/:id
DELETE /api/labor/assignments/:id
POST   /api/labor/optimize/:date
GET    /api/labor/tasks
POST   /api/labor/tasks
GET    /api/labor/efficiency/:date
GET    /api/labor/dashboard/realtime
```

### フロントエンド画面
- /shifts/calendar - シフトカレンダー
- /shifts/my-shift - 個人シフト
- **/shifts-labor/integrated - 統合管理画面（新規）**
- **/shifts-labor/labor-grid - レイバー配置グリッド（新規）**
- /admin/shifts/patterns - シフトパターン管理
- /admin/shifts/assign - シフト割当
- /admin/shifts/requirements - 人員要件設定
- **/admin/labor/optimization - レイバー最適化設定（新規）**

### **新規コンポーネント構成**
```
/app/shifts-labor/
├── page.tsx                        # 統合管理メインページ
├── components/
│   ├── shift-calendar.tsx          # シフトカレンダー（拡張）
│   ├── labor-grid.tsx              # レイバー配置グリッド
│   ├── employee-skill-panel.tsx    # 従業員スキル情報
│   ├── task-management.tsx         # 作業タスク管理
│   ├── optimization-controls.tsx   # 最適化制御
│   └── efficiency-dashboard.tsx    # 効率性ダッシュボード
├── lib/
│   ├── shift-utils.ts              # シフト関連ユーティリティ
│   ├── labor-optimization.ts       # レイバー最適化ロジック
│   ├── efficiency-calculator.ts    # 効率性計算
│   └── skill-matcher.ts            # スキルマッチング
└── types/
    ├── shift.ts                    # シフト型定義
    ├── labor.ts                    # レイバー型定義
    └── efficiency.ts               # 効率性型定義
```

## 依存関係
- 001: 認証・ユーザー管理機能
- 003: 勤怠管理機能
- **007: 技能資格管理機能（スキル連携強化）**

## テスト項目
- [ ] シフトパターンの登録
- [ ] シフト割当の動作
- [ ] 制約条件のチェック
- [ ] 人員過不足の計算
- [ ] シフト交代の処理
- [ ] 深夜帯の判定
- [ ] **レイバー配置の自動生成**
- [ ] **スキルマッチングの精度**
- [ ] **効率性計算の正確性**
- [ ] **最適化アルゴリズムの動作**
- [ ] **リアルタイム更新の動作**

## 完了条件
- [ ] シフトパターンが管理できる
- [ ] シフト割当が機能する
- [ ] シフト表が表示される
- [ ] 制約チェックが動作する
- [ ] 人員配置が最適化される
- [ ] **30分刻みのレイバー配置が機能する**
- [ ] **スキルベースの作業割当が動作する**
- [ ] **効率性の可視化が機能する**
- [ ] **レイバー最適化が実行される**
- [ ] **統合ダッシュボードが正常表示される**

## 実装フェーズ

### Phase 2-1: 基本シフト管理（既存機能）
- [ ] シフトパターン管理
- [ ] シフト割当機能
- [ ] 基本的な制約チェック

### Phase 2-2: レイバー管理基盤
- [ ] レイバー配置グリッドUI
- [ ] 基本的な作業タスク管理
- [ ] シフトとレイバーの連携

### Phase 2-3: 最適化・分析機能
- [ ] スキルベース最適化
- [ ] 効率性計算・可視化
- [ ] 統合ダッシュボード

## 備考
- 24時間稼働の工場に対応
- **30分刻みの詳細管理により、製造現場の細かい作業配置が可能**
- **スキルレベルと作業効率の可視化により、人材育成計画と連携**
- 将来的にはAIによる自動最適化をさらに高度化
- 製造ラインごとの特殊要件に対応
- **ゲーミフィケーション要素（レベルアップ、効率性スコア）の導入検討**

## 追加検討事項
- **モバイル対応**：現場でのリアルタイム確認
- **オフライン機能**：ネットワーク障害時の継続運用
- **他システム連携**：ERPシステムとの生産計画連携
- **多言語対応**：外国人労働者への配慮