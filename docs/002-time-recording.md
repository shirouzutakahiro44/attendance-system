# 002: 打刻機能

## 概要
NFCカード、Web、モバイルからの打刻機能を実装する

## 優先度
**High** - コアとなる機能

## 見積工数
32時間（4人日）

## 機能要件

### 1. Web打刻機能
- [ ] 打刻画面の実装
- [ ] 出勤ボタン
- [ ] 退勤ボタン
- [ ] 休憩開始/終了ボタン
- [ ] 一時外出/戻りボタン
- [ ] 打刻確認ダイアログ
- [ ] 打刻成功/失敗の通知
- [ ] 本日の打刻履歴表示

### 2. NFC打刻機能
- [ ] NFCリーダー連携
- [ ] カードID読み取り
- [ ] カードIDとユーザーの紐付け
- [ ] 打刻種別の自動判定
- [ ] オフライン打刻のキューイング
- [ ] 音声/LED フィードバック

### 3. モバイル打刻
- [ ] レスポンシブ対応
- [ ] 位置情報取得（オプション）
- [ ] QRコード打刻（オプション）
- [ ] プッシュ通知

### 4. 打刻場所管理
- [ ] 打刻場所の登録
  - [ ] 第一工場
  - [ ] 第二工場
  - [ ] 第三工場
  - [ ] プレス工場
  - [ ] 溶接工場
  - [ ] 間接部門
- [ ] IPアドレスによる場所判定
- [ ] 打刻可能場所の制限

### 5. 打刻データ管理
- [ ] 打刻記録の保存
- [ ] 重複打刻の防止
- [ ] 打刻時刻の記録
- [ ] デバイス情報の記録
- [ ] 位置情報の記録（オプション）

## 技術仕様

### データベーステーブル
- time_records
- nfc_cards
- locations
- device_logs

### API エンドポイント
```
POST   /api/time-records/clock-in
POST   /api/time-records/clock-out
POST   /api/time-records/break-start
POST   /api/time-records/break-end
GET    /api/time-records/today
GET    /api/time-records/user/:userId
POST   /api/nfc/register
POST   /api/nfc/record
GET    /api/locations
```

### フロントエンド画面
- /attendance/clock - 打刻画面
- /attendance/history - 打刻履歴
- /admin/nfc - NFCカード管理
- /admin/locations - 場所管理

## 依存関係
- 001: 認証・ユーザー管理機能

## テスト項目
- [ ] 正常な打刻フロー
- [ ] 重複打刻の防止
- [ ] 不正な打刻の検出
- [ ] オフライン時の動作
- [ ] 同時打刻の処理
- [ ] NFCカード読み取り

## 完了条件
- [ ] Web打刻が正常に動作する
- [ ] 打刻データが正しく保存される
- [ ] 打刻履歴が表示される
- [ ] エラーハンドリングが実装されている
- [ ] レスポンスタイム1秒以内

## 備考
- 初期実装ではWeb打刻を優先
- NFCは Phase 2 で実装
- 将来的には顔認証も検討