# 003: 勤怠管理機能

## 概要
日次・月次の勤怠管理、修正申請、承認フローを実装する

## 優先度
**High** - 基本的な勤怠管理に必須

## 見積工数
48時間（6人日）

## 機能要件

### 1. 勤怠表示機能
- [ ] 日次勤怠表示
- [ ] 月次カレンダー表示
- [ ] 勤怠ステータス表示（正常、遅刻、早退、欠勤）
- [ ] 労働時間の自動計算
- [ ] 残業時間の表示
- [ ] 深夜労働時間の表示
- [ ] 休日労働時間の表示

### 2. 勤怠修正機能
- [ ] 打刻忘れの修正申請
- [ ] 打刻時刻の修正申請
- [ ] 修正理由の入力
- [ ] 修正履歴の保持
- [ ] 承認前/承認後の表示切替

### 3. 申請機能
- [ ] 残業申請（事前/事後）
- [ ] 有給休暇申請
- [ ] 特別休暇申請
- [ ] 振替休日申請
- [ ] 申請理由の入力
- [ ] 申請ステータス管理

### 4. 承認フロー
- [ ] 承認者の自動判定
- [ ] 承認/差戻/却下
- [ ] 承認コメント機能
- [ ] 一括承認機能
- [ ] 承認期限アラート
- [ ] エスカレーション機能

### 5. 労働時間計算
- [ ] 法定労働時間（8時間/日、40時間/週）
- [ ] 所定労働時間の管理
- [ ] 休憩時間の自動付与
  - [ ] 6時間超：45分
  - [ ] 8時間超：60分
- [ ] フレックスタイム対応
- [ ] 変形労働時間制対応

### 6. 36協定管理
- [ ] 月間残業時間上限チェック（45時間）
- [ ] 年間残業時間上限チェック（360時間）
- [ ] 特別条項の管理
  - [ ] 年720時間以内
  - [ ] 複数月平均80時間以内
  - [ ] 単月100時間未満
- [ ] 上限接近アラート

## 技術仕様

### データベーステーブル
- attendance_daily
- attendance_requests
- approval_flows
- overtime_management
- leave_balances
- work_regulations

### API エンドポイント
```
GET    /api/attendance/daily/:date
GET    /api/attendance/monthly/:yearMonth
POST   /api/attendance/correct
GET    /api/requests
POST   /api/requests/overtime
POST   /api/requests/leave
PUT    /api/requests/:id/approve
PUT    /api/requests/:id/reject
GET    /api/overtime/summary
GET    /api/leave/balance
```

### フロントエンド画面
- /attendance/daily - 日次勤怠
- /attendance/monthly - 月次勤怠
- /attendance/requests - 申請一覧
- /attendance/requests/new - 新規申請
- /manager/approvals - 承認待ち一覧

## 依存関係
- 001: 認証・ユーザー管理機能
- 002: 打刻機能

## テスト項目
- [ ] 労働時間計算の正確性
- [ ] 36協定上限チェック
- [ ] 承認フローの動作
- [ ] 休憩時間の自動付与
- [ ] 深夜割増計算
- [ ] 休日割増計算

## 完了条件
- [ ] 勤怠データが正しく表示される
- [ ] 修正申請が機能する
- [ ] 承認フローが動作する
- [ ] 労働時間が正しく計算される
- [ ] 法令遵守チェックが機能する

## 備考
- 労働基準法の要件を満たすこと
- 計算ロジックは十分にテストすること
- 将来的にはAIによる異常検知も検討